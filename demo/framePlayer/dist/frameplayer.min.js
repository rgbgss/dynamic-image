var FramePlayer=function(e,t){this.divCont=document.getElementById(e),this.elem=e,this.jsonVideoSrc=this.divCont.getAttribute("data-vidsrc"),this.rate=20,this.controls=!0,this.paused=!1,this.width="480px",this.height="320px",this.backwards=!1,this.currentFrame=-1,this.startFrame=0,this.radius=null,this.setOptions(t),this.initializeRequestAnimationFrame(),this.img=document.createElement("img"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.divCont.appendChild(this.canvas)};FramePlayer.prototype.setOptions=function(e){if("rate"in e&&(this.rate=e.rate),"controls"in e&&(this.controls=e.controls),"autoplay"in e&&(e.autoplay||(this.paused=!0)),"width"in e&&(this.width=e.width),"height"in e&&(this.height=e.height),"startFrame"in e&&(this.startFrame=this.currentFrame=e.startFrame),"backwards"in e&&(this.backwards=e.backwards),"radius"in e){var t=document.createElement("style");t.setAttribute("id","style-"+this.elem),t.innerHTML="#"+this.elem+", .frames-"+this.elem+"{ border-radius: "+e.radius+"; overflow: hidden;}",document.head.appendChild(t)}this.divCont.style.width=this.width,this.divCont.style.height=this.height,this.controls&&this.createControlBar()},FramePlayer.prototype.render=function(e){var t,a,n=Date.now(),i=1e3/e.rate,r=e.jsonVideoFile.frames.length,s=function(){t=Date.now(),a=t-n,a>i&&(n=t-a%i,e.paused||(e.currentFrame=e.backwards?e.currentFrame-=1:e.currentFrame+=1,e.currentFrame>=r?e.currentFrame=0:e.currentFrame<0&&(e.currentFrame=r-1),e.drawFrame(e))),window.requestAnimationFrame(s)};window.requestAnimationFrame(s)},FramePlayer.prototype.drawFrame=function(e){e.img.src=e.jsonVideoFile.frames[e.currentFrame],e.context.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)},FramePlayer.prototype.createControlBar=function(){var e=this,t=document.createElement("div");t.setAttribute("class","fp-ctrl"),t.style.width=this.width;var a=document.createElement("button");a.setAttribute("id","pause-"+e.elem),a.setAttribute("class","fp-btn"),a.innerHTML="Pause",a.addEventListener("click",function(){e.pause()},!1),t.appendChild(a);var n=document.createElement("button");n.setAttribute("id","play-"+e.elem),n.setAttribute("class","fp-btn"),n.innerHTML="Play",n.addEventListener("click",function(){e.resume()},!1),t.appendChild(n);var i=document.createElement("button");i.setAttribute("id","backwards-"+e.elem),i.setAttribute("class","fp-btn"),i.innerHTML="Backward",i.addEventListener("click",function(){e.reverse()},!1),t.appendChild(i),e.paused?a.style.display="none":n.style.display="none";for(var r=document.createElement("select"),s=["normal","grayscale","sepia","invert"],o=0,l=s.length;l>o;o++){var d=document.createElement("option");d.setAttribute("value",s[o]),d.innerHTML=s[o],r.appendChild(d)}r.setAttribute("id","filter-"+e.elem),r.setAttribute("class","fp-select"),r.addEventListener("change",function(){e.setFilter(this.value)},!1),t.appendChild(r);var c=document.createElement("label"),m=document.createElement("input"),u=document.createElement("input");c.className="to-frame",m.type="text",m.name="frame",m.value=e.startFrame,m.className="to-frame",e.toFrameInput=m,u.type="submit",u.value="go to frame",u.onclick=function(){value=parseInt(m.value,10),e.gotoFrame(value)},c.appendChild(m),c.appendChild(u),t.appendChild(c),this.divCont.appendChild(t)},FramePlayer.prototype.play=function(){this.getFile(this.jsonVideoSrc,function(e){e.paused?(e.render(e),e.drawFrame(e)):e.render(e)})},FramePlayer.prototype.resume=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="none",t.style.display="block",this.paused=!1},FramePlayer.prototype.pause=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="block",t.style.display="none",this.paused=!0},FramePlayer.prototype.reverse=function(){var e=document.getElementById("backwards-"+this.elem);this.backwards=!this.backwards,value=this.backwards?"Forward":"Backward",e.innerHTML=value},FramePlayer.prototype.gotoFrame=function(e){e===parseInt(e,10)&&(this.currentFrame=this.startFrame=this.toFrameInput.value=e,void 0===this.jsonVideoFile?this.play():this.drawFrame(this))},FramePlayer.prototype.setFilter=function(e){var t=document.querySelector("#"+this.elem+" canvas");switch(e){case"normal":t.setAttribute("class","");break;case"grayscale":t.setAttribute("class","fp-grayscale");break;case"sepia":t.setAttribute("class","fp-sepia");break;case"invert":t.setAttribute("class","fp-invert")}},FramePlayer.prototype.getFile=function(e,t){var a=new XMLHttpRequest,n=this,i=document.createElement("p");if(!a)throw"Error loading file.";a.open("GET",e,!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(null),a.onprogress=function(){i.innerHTML="Loading...",i.setAttribute("class","fp-loading"),n.divCont.appendChild(i)},void 0!==typeof a.onload?a.onload=function(){n.divCont.removeChild(i),n.jsonVideoFile=JSON.parse(this.responseText),t(n),a=null}:a.onreadystatechange=function(){4===a.readyState&&(n.divCont.removeChild(i),n.jsonVideoFile=JSON.parse(this.responseText),t(n),a=null)}},FramePlayer.prototype.initializeRequestAnimationFrame=function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),r=window.setTimeout(function(){t(n+i)},i);return e=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})};